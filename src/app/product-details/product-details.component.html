@if (loading()) {
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading product details...</p>
  </div>
}

@if (error()) {
  <div class="error-message">
    <p>{{ error() }}</p>
    <button class="back-btn" routerLink="/">← Back to Home</button>
  </div>
}

@if (!loading() && !error() && product(); as prod) {
  <div class="container">
    <button class="back-btn" routerLink="/">← Back to Home</button>

    <div class="product-details">
      <div class="image-carousel">
        <div class="carousel-container">
          <img
            [src]="prod.imageUrls[currentImageIndex()] || ''"
            [alt]="prod.name || 'Product image'"
            class="main-image"
            loading="lazy"
          />

          @if (prod.imageUrls.length > 1) {
            <button
              class="nav-btn prev"
              (click)="prevImage()"
              [disabled]="currentImageIndex() === 0"
            >
              ‹
            </button>

            <button
              class="nav-btn next"
              (click)="nextImage()"
              [disabled]="currentImageIndex() === prod.imageUrls.length - 1"
            >
              ›
            </button>
          }
        </div>

        @if (prod.imageUrls.length > 1) {
          <div class="dots">
            @for (url of prod.imageUrls; track $index) {
              <span
                class="dot"
                [class.active]="$index === currentImageIndex()"
                (click)="goToImage($index)"
              ></span>
            }
          </div>
        }
      </div>

      <div class="product-info">
        <h1 class="product-title">{{ prod.title }}</h1>
        <p class="product-name">{{ prod.name }}</p>
        <p class="product-price">${{ prod.price }}</p>

        <p class="stock-status" [ngClass]="getStockClass()">
          {{ getStockStatus() }} ({{ prod.stock }} available)
        </p>

        <p class="product-description">{{ prod.description }}</p>

        <button class="add-to-cart-btn">Add to Cart</button>
      </div>
    </div>
  </div>
}
